{"version":3,"sources":["assets/scripts/fairyland/ui/component/common/AlertViewComponent.ts","assets/scripts/native/AnalyticsUtils.ts","assets/scripts/App.ts","assets/scripts/fairyland/Consts.ts","assets/scripts/demo/DemoBattleMain.ts","assets/scripts/fairyland/ui/component/demo/DemoHomeComponent.ts","assets/scripts/fairyland/ui/component/demo/DemoLoginComponent.ts","assets/scripts/fairyland/ui/component/demo/DemoPropCellComponent.ts","assets/scripts/fairyland/system/DeployLaborForceSystem.ts","assets/scripts/fairyland/system/DeployLaborForceToPropSystem.ts","assets/scripts/fairyland/utils/Formatter.ts","assets/scripts/fairyland/system/HandlePropSystem.ts","assets/scripts/fairyland/system/InitOriginSystem.ts","assets/scripts/fairyland/system/LocalStorageSystem.ts","assets/scripts/sys/i18n/Localized.ts","assets/scripts/MainComponent.ts","assets/scripts/native/NativeResponse.ts","assets/scripts/fairyland/State.ts","assets/scripts/sys/Utils.ts"],"names":["_a","cc","_decorator","ccclass","property","AlertViewComponent","_super","_this","apply","this","arguments","label","__extends","prototype","setTitle","title","string","onClickClose","node","active","__decorate","Label","Component","exports","default","AnalyticsUtils","trackPageAppear","page","sys","isNative","os","OS_IOS","jsb","reflection","callStaticMethod","JSON","stringify","trackPageDisappear","trackEvent","name","properties","trackEventDurationBegin","trackEventDurationEnd","trackEventWithDuration","duration","AlertViewComponent_1","require","App","main","s_instance","Error","getInstance","Object","defineProperty","get","getChildByName","showAlert","getComponent","big_js_1","PLACE_PROP_ID","B_CONFINE_MAX","K_CONFINE_MAX","mul","M_CONFINE_MAX","G_CONFINE_MAX","_","DemoBattleMain","m_monsterGroups","m_monsters","monsterViews","monsterListView","onLoad","genMonsters","updateMonsterListView","genMonster","hp","random","atk","max","i","push","sort","a","b","divideIntoGroups","split","Math","floor","length","limit","j","onClickAttack","_i","damage","_b","group_1","m","updateMonsterViews","onClickMonsterList","onClickCloseMonsterListView","onClickDivide","index","labelNode","group","count","group_2","color","Color","RED","BLACK","content","setContentSize","winSize","width","height","removeAllChildren","Node","opacity","anchorY","y","addComponent","fontSize","addChild","getContentSize","State_1","App_1","Consts_1","DemoPropCellComponent_1","DeployLaborForceSystem_1","HandlePropSystem_1","DeployLaborForceToPropSystem_1","DemoHomeComponent","labelNum","listView","cellTemplate","m_elapse","onAttributeChanged","bind","updateLabelUpdate","size","offset","v2","propConfigs","configs","props","PROP_KEYS","contentSize","_loop_1","cell","instantiate","this_1","x","parseInt","k","config","cellComponent","DemoPropCellComponent","prop","getProp","id","place","dependencies","arr","num","depConfig","join","initProps","increaseRate","laborForce","onPressPlus","addLaborForceToProp","onPressMinus","subLaborForceFromProp","on","onDestroy","removeListener","update","dt","now","Date","origin","timestamp","produceProps","set","onClickAddMaxLaborForce","addMaxLaborForce","save","onClickSubMaxLaborForce","subMaxLaborForce","propId","args","route","getLaborForce","getMaxLaborForce","ScrollView","Prefab","Utils","LocalStorageSystem_1","DemoLoginComponent","eBoxAccountInput","loadConfigs","sent","account","getAccount","loadAccount","enterHome","onLoginClick","trim","setAccount","loadPrefab","resource","homeNode","gameContainer","destroy","EditBox","Localized_1","Formatter_1","m_props","m_isInit","labelName","labelIncreaseRate","labelLaborForce","getListenerKey","setNum","setIncreaseRate","setName","setLaborForce","value","formatPropNum","getValueSync","bigValue","eq","WHITE","lt","GREEN","add","state","addend","result","plus","toString","isCanSub","subtractor","gte","sub","minus","isCanSubMaxLaborForce","addLaborForce","isCanSubLaborForce","subLaborForce","maxLaborForce","addedLaborForce","bigCurrentLaborForce","bigAddedLaborForce","subedLaborForce","bigPropCurrentLaborForce","bigNum","div","toFixed","getPropKey","getDefaultProp","lastNum","setProp","assign","calculateIncreaseRate","calculatePureProduceNum","numPerSec","numPerLaborForce","produceProp","filter","advanceProduceNum","actualProduceNum","depProp","gt","tempActualProduceNum","_c","_d","_e","consume","PLACE_PROP_ID_1","PLACE_PROP_ID_2","PLACE_PROP_ID_3","initOrigin","localStorage","getItem","setItem","NativeResponse_1","Localized","getLanguage","s_language","Promise","resolve","isBrowser","process","window","navigator","language","callback","getValue","key","loadLocalizedText","s_dict","s_defaultDict","getDefaultTTF","localizeLabel","reject","__awaiter","loader","loadRes","Font","err","font","getLocalizedRes","url","toLocaleLowerCase","log","indexOf","language_1","p1","file","json","p2_1","then","catch","MainComponent","loginNode","s_session","s_callbacks","NativeResponse","session","onNativeResponse","isRemove","undefined","events_1","InitOriginSystem_1","State","call","m_origin","user","m_configs","emit","defaultValue","getOriginLocalStorageKey","loadJson","jsonOrigin","parse","EventEmitter","jsonAssets"],"mappings":"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","sourcesContent":["/**\n * 警告弹窗\n * @author Radish\n */\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class AlertViewComponent extends cc.Component {\n  /**\n   * 设置弹窗提示标题\n   * @author Radish\n   */\n  public setTitle(title: string) {\n    this.label.string = title;\n  }\n\n  /**\n   * 点击关闭按钮\n   * @author Radish\n   */\n  public onClickClose() {\n    this.node.active = false;\n  }\n\n  @property(cc.Label)\n  label: cc.Label = null;\n}\n","/**\n * 分析统计 SDK 调用接口\n * @author Radish\n */\n\nexport default class AnalyticsUtils {\n  /**\n   * 页面呈现时调用\n   * @author Radish\n   */\n  public static trackPageAppear(page: string) {\n    if (cc.sys.isNative && cc.sys.os === cc.sys.OS_IOS) {\n      jsb.reflection.callStaticMethod(\n        \"AnalyticsUtils\",\n        \"trackPageAppear:\",\n        JSON.stringify({ page })\n      );\n    }\n  }\n\n  /**\n   * 页面关闭时调用\n   * @author Radish\n   */\n  public static trackPageDisappear(page: string) {\n    if (cc.sys.isNative && cc.sys.os === cc.sys.OS_IOS) {\n      jsb.reflection.callStaticMethod(\n        \"AnalyticsUtils\",\n        \"trackPageDisappear:\",\n        JSON.stringify({ page })\n      );\n    }\n  }\n\n  /**\n   * 追踪事件\n   * @author Radish\n   */\n  public static trackEvent(name: string, properties?: { [k: string]: string }) {\n    if (cc.sys.isNative && cc.sys.os === cc.sys.OS_IOS) {\n      jsb.reflection.callStaticMethod(\n        \"AnalyticsUtils\",\n        \"trackEvent:\",\n        JSON.stringify({ name, properties })\n      );\n    }\n  }\n\n  /**\n   * 上报事件开始\n   * @author Radish\n   */\n  public static trackEventDurationBegin(name: string) {\n    if (cc.sys.isNative && cc.sys.os === cc.sys.OS_IOS) {\n      jsb.reflection.callStaticMethod(\n        \"AnalyticsUtils\",\n        \"trackEventDurationBegin:\",\n        JSON.stringify({ name })\n      );\n    }\n  }\n\n  /**\n   * 上报事件结束\n   * @author Radish\n   */\n  public static trackEventDurationEnd(name: string) {\n    if (cc.sys.isNative && cc.sys.os === cc.sys.OS_IOS) {\n      jsb.reflection.callStaticMethod(\n        \"AnalyticsUtils\",\n        \"trackEventDurationEnd:\",\n        JSON.stringify({ name })\n      );\n    }\n  }\n\n  /**\n   * 上报一个带时长的事件\n   * @author Radish\n   */\n  public static trackEventWithDuration(name: string, duration: number) {\n    if (cc.sys.isNative && cc.sys.os === cc.sys.OS_IOS) {\n      jsb.reflection.callStaticMethod(\n        \"AnalyticsUtils\",\n        \"trackEventWithDuration:\",\n        JSON.stringify({ name, duration })\n      );\n    }\n  }\n}\n","/**\n * 当前客户端的 App 实例\n * @author Radish\n */\n\nimport AlertViewComponent from \"./fairyland/ui/component/common/AlertViewComponent\";\n\nexport default class App {\n  /**\n   * 单例模式, 获得 App 实例\n   * @author Radish\n   */\n  public static getInstance() {\n    if (this.s_instance === null) {\n      this.s_instance = new App();\n    }\n    return this.s_instance;\n  }\n\n  /**\n   * 获得 gameContainer 容器\n   * @author Radish\n   */\n  public get gameContainer(): cc.Node {\n    return this.main.getChildByName(\"gameContainer\");\n  }\n\n  /**\n   * 获得 sysContainer 容器\n   * @author Radish\n   */\n  public get sysContainer(): cc.Node {\n    return this.main.getChildByName(\"sysContainer\");\n  }\n\n  /**\n   * 显示弹窗\n   * @author Radish\n   */\n  public showAlert(title: string) {\n    let node = this.main.getChildByName(\"alertView\");\n    let component = node.getComponent(AlertViewComponent);\n    component.setTitle(title);\n    node.active = true;\n  }\n\n  public main: cc.Node = null;\n\n  /********************************************************************************\n   * private\n   ********************************************************************************/\n\n  private constructor() {\n    if (App.s_instance !== null) {\n      throw new Error(\"App already initialized.\");\n    }\n  }\n  private static s_instance: App = null;\n}\n","/**\n * 通用常量定义\n * @author Radish\n */\n\nimport Big from \"big.js\";\n\nexport let PLACE_PROP_ID = [\"0\", \"1\", \"2\", \"3\", \"4\", \"5\"];\nexport let B_CONFINE_MAX = new Big(1000);\nexport let K_CONFINE_MAX = B_CONFINE_MAX.mul(1000);\nexport let M_CONFINE_MAX = K_CONFINE_MAX.mul(1000);\nexport let G_CONFINE_MAX = M_CONFINE_MAX.mul(1000);\n","const { ccclass, property } = cc._decorator;\n\nimport * as _ from \"lodash\";\n\ninterface Monster {\n  name: string;\n  hp: number;\n  atk: number;\n}\n\n@ccclass\nexport default class DemoBattleMain extends cc.Component {\n  onLoad() {\n    this.genMonsters();\n    this.updateMonsterListView();\n  }\n\n  /**\n   * 生成单个怪物对象\n   * @author Radish\n   */\n  private genMonster(): Monster {\n    return {\n      name: \"鸭嘴兽\",\n      hp: _.random(1, 100, false),\n      atk: 1\n    };\n  }\n\n  /**\n   * 生成怪物对象集合\n   * @author Radish\n   */\n  private genMonsters() {\n    let max = _.random(20, 50, false);\n    for (let i = 0; i < max; ++i) {\n      this.m_monsters.push(this.genMonster());\n    }\n    this.m_monsters.sort((a, b) => {\n      return a.hp - b.hp;\n    });\n  }\n\n  /**\n   * 降怪物分组\n   * @author Radish\n   */\n  private divideIntoGroups() {\n    this.m_monsterGroups = [[], [], []];\n    let split = Math.floor(this.m_monsters.length / 3);\n    for (let i = 0; i < 3; ++i) {\n      let limit = split * (i + 1);\n      if (i === 2) {\n        limit = this.m_monsters.length;\n      }\n\n      for (let j = split * i; j < limit; ++j) {\n        this.m_monsterGroups[i].push(this.m_monsters[j]);\n      }\n    }\n  }\n\n  /**\n   * 点击攻击\n   * @author Radish\n   */\n  private onClickAttack() {\n    for (let group of this.m_monsterGroups) {\n      let damage = 100;\n      for (let m of group) {\n        if (damage > 0) {\n          if (m.hp >= damage) {\n            m.hp -= damage;\n            damage = 0;\n          } else {\n            damage -= m.hp;\n            m.hp = 0;\n          }\n        }\n\n        if (damage === 0) {\n          break;\n        }\n      }\n    }\n\n    this.updateMonsterViews();\n  }\n\n  /**\n   * 点击怪物列表\n   * @author Radish\n   */\n  private onClickMonsterList() {\n    this.monsterListView.active = true;\n  }\n\n  private onClickCloseMonsterListView() {\n    this.monsterListView.active = false;\n  }\n\n  /**\n   * 点击拆分\n   * @author Radish\n   */\n  private onClickDivide() {\n    this.divideIntoGroups();\n    this.updateMonsterViews();\n  }\n\n  /**\n   * 更新妖怪视图\n   * @author Radish\n   */\n  private updateMonsterViews() {\n    for (let index in this.m_monsterGroups) {\n      let view = this.monsterViews[index];\n      let labelNode = view.getChildByName(\"label\");\n      let label = labelNode.getComponent(cc.Label);\n\n      let group = this.m_monsterGroups[index];\n      if (group.length === 0) {\n        label.string = \"-\";\n        continue;\n      }\n\n      let hp = 0;\n      let count = 0;\n      let name = \"\";\n      for (let m of group) {\n        if (name === \"\") {\n          name = m.name;\n        }\n\n        hp += m.hp;\n        if (m.hp > 0) {\n          ++count;\n        }\n      }\n\n      label.string = `${name}\\n血量: ${hp}\\n数量: ${count}`;\n\n      if (count === 0) {\n        labelNode.color = cc.Color.RED;\n      } else {\n        labelNode.color = cc.Color.BLACK;\n      }\n    }\n  }\n\n  /**\n   * 更新\n   */\n  private updateMonsterListView() {\n    let view = this.monsterListView.getChildByName(\"view\");\n    let content = view.getChildByName(\"content\");\n    content.setContentSize(cc.winSize.width, cc.winSize.height);\n    content.removeAllChildren();\n\n    let height = 0;\n    for (let i in this.m_monsters) {\n      let m = this.m_monsters[i];\n      let node = new cc.Node();\n      if (m.hp > 0) {\n        node.color = cc.Color.BLACK;\n      } else {\n        node.color = cc.Color.RED;\n      }\n      node.opacity = 255;\n      node.anchorY = 1.0;\n      node.y = -i * 32;\n      height += 32;\n\n      let label = node.addComponent(cc.Label);\n      label.fontSize = 24;\n      label.string = `=>${i + 1}, ${m.name}, hp = ${m.hp}`;\n\n      content.addChild(node);\n    }\n\n    if (content.getContentSize().height < height) {\n      content.setContentSize(cc.winSize.width, height);\n    }\n  }\n\n  private m_monsterGroups: Array<Monster[]> = [[], [], []];\n  private m_monsters: Monster[] = [];\n\n  @property([cc.Node])\n  public monsterViews: cc.Node[] = [];\n\n  @property(cc.Node)\n  public monsterListView: cc.Node = null;\n}\n","/**\n * Demo 家园\n * @author Radish\n */\n\nconst { ccclass, property } = cc._decorator;\n\nimport State from \"../../../State\";\nimport App from \"../../../../App\";\nimport { IPropConfig, IProp } from \"../../../Types\";\nimport { PLACE_PROP_ID } from \"../../../Consts\";\nimport { DemoPropCellComponent } from \"./DemoPropCellComponent\";\nimport {\n  getLaborForce,\n  getMaxLaborForce,\n  addMaxLaborForce,\n  subMaxLaborForce\n} from \"../../../system/DeployLaborForceSystem\";\nimport { getProp, produceProps } from \"../../../system/HandlePropSystem\";\nimport {\n  addLaborForceToProp,\n  subLaborForceFromProp\n} from \"../../../system/DeployLaborForceToPropSystem\";\n\n@ccclass\nexport default class DemoHomeComponent extends cc.Component {\n  onLoad() {\n    this.onAttributeChanged = this.onAttributeChanged.bind(this);\n    this.updateLabelUpdate();\n\n    // 列表\n    let size = this.listView.content.getContentSize();\n    let offset = cc.v2(-size.width * 0.5 + 64, 0);\n    let propConfigs = State.getInstance().configs.props;\n    const PROP_KEYS = PLACE_PROP_ID;\n    let contentSize = cc.size(size.width, 0);\n    for (let i in PROP_KEYS) {\n      let cell = cc.instantiate(this.cellTemplate) as cc.Node;\n      this.listView.content.addChild(cell);\n\n      cell.x = offset.x;\n      cell.y = offset.y + (parseInt(i) + 1) * -cell.getContentSize().height;\n      contentSize.height += cell.getContentSize().height;\n\n      let k = PROP_KEYS[i];\n      let config: IPropConfig = propConfigs[k];\n\n      let cellComponent = cell.getComponent(DemoPropCellComponent);\n      let prop: IProp = getProp(State.getInstance(), config.id);\n      let name: string = config.name;\n      if (config.place && config.place.dependencies) {\n        name += \"(\";\n        let arr = [];\n        for (const { id, num } of config.place.dependencies) {\n          let depConfig = State.getInstance().configs.props[id];\n          arr.push(`${num}${depConfig.name}`);\n        }\n        name += arr.join(\"+\");\n        name += \")\";\n      }\n      cellComponent.initProps({\n        id: config.id,\n        num: prop.num,\n        name,\n        increaseRate: prop.increaseRate,\n        laborForce: prop.laborForce,\n        onPressPlus: () => {\n          this.addLaborForceToProp(config.id, \"1\");\n        },\n        onPressMinus: () => {\n          this.subLaborForceFromProp(config.id, \"1\");\n        }\n      });\n    }\n    this.listView.content.setContentSize(contentSize);\n\n    State.getInstance().on(\"attribute_changed\", this.onAttributeChanged);\n  }\n\n  onDestroy() {\n    State.getInstance().removeListener(\n      \"attribute_changed\",\n      this.onAttributeChanged\n    );\n  }\n\n  update(dt: number) {\n    let now = Date.now();\n    let duration = (now - State.getInstance().origin.timestamp) / 1000;\n    if (duration >= 0.1) {\n      produceProps(State.getInstance(), duration);\n      State.getInstance().set(\"timestamp\", now);\n    }\n  }\n\n  /**\n   * 点击 + 按钮\n   * @author Radish\n   */\n  public onClickAddMaxLaborForce() {\n    addMaxLaborForce(State.getInstance(), \"1\");\n    State.getInstance().save();\n  }\n\n  /**\n   * 点击 - 按钮\n   * @author Radish\n   */\n  public onClickSubMaxLaborForce() {\n    if (!subMaxLaborForce(State.getInstance(), \"1\")) {\n      App.getInstance().showAlert(\"目前不满足减少劳动力上限条件\");\n    } else {\n      State.getInstance().save();\n    }\n  }\n\n  /**\n   * 给道具增加劳动力分配\n   * @author Radish\n   */\n  public addLaborForceToProp(propId: string, num: string) {\n    if (addLaborForceToProp(State.getInstance(), propId, num)) {\n      State.getInstance().save();\n    } else {\n      App.getInstance().showAlert(\"劳动力不足\");\n    }\n  }\n\n  /**\n   * 给道具减少劳动力分配\n   * @author Radish\n   */\n  public subLaborForceFromProp(propId: string, num: string) {\n    if (subLaborForceFromProp(State.getInstance(), propId, num)) {\n      State.getInstance().save();\n    } else {\n      App.getInstance().showAlert(\"该道具已没有多余的劳动力\");\n    }\n  }\n\n  /**\n   * 保存\n   * @author Radish\n   */\n  public save() {\n    State.getInstance().save();\n  }\n\n  private onAttributeChanged(args: { route: string; value: any }) {\n    if (args.route === \"laborForce\" || args.route === \"maxLaborForce\") {\n      this.updateLabelUpdate();\n    }\n  }\n\n  /**\n   * 更新 labelNum 视图显示\n   * @author Radish\n   */\n  private updateLabelUpdate() {\n    this.labelNum.string = `${getLaborForce(\n      State.getInstance()\n    )}/${getMaxLaborForce(State.getInstance())}`;\n  }\n\n  @property(cc.Label)\n  labelNum: cc.Label = null;\n\n  @property(cc.ScrollView)\n  listView: cc.ScrollView = null;\n\n  @property(cc.Prefab)\n  cellTemplate: cc.Prefab = null;\n\n  private m_elapse: number = 0;\n}\n","/**\n * Demo 登录界面\n * @author Radish\n */\n\nconst { ccclass, property } = cc._decorator;\n\nimport App from \"../../../../App\";\nimport * as Utils from \"../../../../sys/Utils\";\nimport State from \"../../../State\";\nimport { getAccount, setAccount } from \"../../../system/LocalStorageSystem\";\n\n@ccclass\nexport default class DemoLoginComponent extends cc.Component {\n  async onLoad() {\n    await State.getInstance().loadConfigs();\n\n    let account = getAccount();\n    if (account) {\n      this.eBoxAccountInput.string = account;\n      await State.getInstance().loadAccount(account);\n      this.enterHome();\n    }\n  }\n\n  /**\n   * 点击登录\n   * @author Radish\n   */\n  public async onLoginClick() {\n    if (this.eBoxAccountInput.string === \"\" || !this.eBoxAccountInput.string) {\n      App.getInstance().showAlert(\"用户名不能为空\");\n      return;\n    }\n\n    let account = this.eBoxAccountInput.string.trim();\n    State.getInstance().set(\"user\", {\n      id: \"0\",\n      account,\n      name: account\n    });\n    setAccount(account);\n    State.getInstance().save();\n\n    await this.enterHome();\n  }\n\n  /**\n   * 进入家园界面\n   * @author Radish\n   */\n  private async enterHome() {\n    let resource = await Utils.loadPrefab(\"prefabs/DemoHome\");\n    let homeNode = cc.instantiate(resource);\n    App.getInstance().gameContainer.addChild(homeNode as cc.Node);\n    this.node.destroy();\n  }\n\n  @property(cc.EditBox)\n  eBoxAccountInput: cc.EditBox = null;\n}\n","/**\n * 放置道具列表中的单项元素\n * @author Radish\n */\n\nconst { ccclass, property } = cc._decorator;\n\nimport Localized from \"../../../../sys/i18n/Localized\";\nimport State from \"../../../State\";\nimport { IProp } from \"../../../Types\";\nimport Big from \"big.js\";\nimport { formatPropNum } from \"../../../utils/Formatter\";\n\nexport interface IProps {\n  id: string; // 道具 id\n  num: string; // 当前拥有数量\n  name: string; // 名字\n  increaseRate: string; // 增长率\n  laborForce: string; // 分配的妖怪种类数量\n\n  onPressPlus: () => void; // 点击 + 号按钮\n  onPressMinus: () => void; // 点击 - 号按钮\n}\n\n@ccclass\nexport class DemoPropCellComponent extends cc.Component {\n  onDestroy() {\n    State.getInstance().removeListener(\n      this.getListenerKey(),\n      this.onAttributeChanged\n    );\n  }\n\n  /**\n   * 初始化显示\n   * @author Radish\n   */\n  public initProps(props: IProps) {\n    if (this.m_isInit) {\n      return;\n    }\n\n    this.m_isInit = true;\n    this.m_props = props;\n\n    this.setNum(this.m_props.num);\n    this.setIncreaseRate(this.m_props.increaseRate);\n    this.setName(this.m_props.name);\n    this.setLaborForce(this.m_props.laborForce);\n\n    this.onAttributeChanged = this.onAttributeChanged.bind(this);\n    State.getInstance().on(this.getListenerKey(), this.onAttributeChanged);\n  }\n\n  /**\n   * 设置数量\n   * @author Radish\n   */\n  public setNum(value: string) {\n    this.labelNum.string = formatPropNum(value);\n  }\n\n  /**\n   * 设置名字\n   * @author Radish\n   */\n  public setName(value: string) {\n    this.labelName.string = value;\n  }\n\n  /**\n   * 设置增长率\n   * @author Radish\n   */\n  public setIncreaseRate(value: string) {\n    this.labelIncreaseRate.string =\n      Localized.getValueSync(\"增长率: \") +\n      value +\n      Localized.getValueSync(\"/秒\");\n\n    let bigValue = new Big(value);\n    if (bigValue.eq(0)) {\n      this.labelIncreaseRate.node.color = cc.Color.WHITE;\n    } else if (bigValue.lt(0)) {\n      this.labelIncreaseRate.node.color = cc.Color.RED;\n    } else {\n      this.labelIncreaseRate.node.color = cc.Color.GREEN;\n    }\n  }\n\n  /**\n   * 设置妖怪类别数量\n   * @author Radish\n   */\n  public setLaborForce(value: string) {\n    this.labelLaborForce.string = value;\n  }\n\n  /**\n   * 点击 + 号按钮\n   * @author Radish\n   */\n  public onPressPlus() {\n    this.m_props.onPressPlus();\n  }\n\n  /**\n   * 点击 - 号按钮\n   * @author Radish\n   */\n  public onPressMinus() {\n    this.m_props.onPressMinus();\n  }\n\n  /**\n   * 侦听 State 的属性修改\n   * @author Radish\n   */\n  private onAttributeChanged(args: { route: string; value: IProp }) {\n    this.setNum(args.value.num);\n    this.setLaborForce(args.value.laborForce);\n    this.setIncreaseRate(args.value.increaseRate);\n  }\n\n  /**\n   * 获得侦听的键\n   * @author Radish\n   */\n  private getListenerKey() {\n    return \"attribute_changed_\" + `props[${this.m_props.id}]`;\n  }\n\n  private m_props: IProps = null;\n  private m_isInit: boolean = false;\n\n  @property(cc.Label)\n  labelNum: cc.Label = null;\n\n  @property(cc.Label)\n  labelName: cc.Label = null;\n\n  @property(cc.Label)\n  labelIncreaseRate: cc.Label = null;\n\n  @property(cc.Label)\n  labelLaborForce: cc.Label = null;\n}\n","/**\n * 在 demo 中, 劳动力的处理方式\n * @author Radish\n */\n\nimport State from \"../State\";\nimport Big from \"big.js\";\n\nfunction add(state: State, route: string, addend: string): string {\n  let num: Big = new Big(state.get(route));\n  let result = num.plus(addend).toString();\n  state.set(route, result);\n  return result;\n}\n\nfunction isCanSub(state: State, route: string, subtractor: string): boolean {\n  let num: Big = new Big(state.get(route));\n  return num.gte(subtractor);\n}\n\nfunction sub(state: State, route: string, subtractor: string): boolean {\n  if (isCanSub(state, route, subtractor)) {\n    let num: Big = new Big(state.get(route));\n    state.set(route, num.minus(subtractor).toString());\n    return true;\n  }\n  return false;\n}\n\n/**\n * 获得当前劳动力的数量\n * @author Radish\n */\nexport function getLaborForce(state: State): string {\n  return state.get(\"laborForce\", \"0\");\n}\n\n/**\n * 获得当前劳动力的最大值\n * @author Radish\n */\nexport function getMaxLaborForce(state: State): string {\n  return state.get(\"maxLaborForce\", \"0\");\n}\n\n/**\n * 增加当前劳动力\n * @return 返回加法运算之后的结果\n * @author Radish\n */\nexport function addLaborForce(state: State, addend: string): string {\n  return add(state, \"laborForce\", addend);\n}\n\n/**\n * 判断是否能够减少当前劳动力总数\n * @returns true 可减, false 不可减\n * @author Radish\n */\nexport function isCanSubLaborForce(state: State, subtractor: string): boolean {\n  return isCanSub(state, \"laborForce\", subtractor);\n}\n\n/**\n * 减少当前劳动力\n * @return 如果减掉 subtractor 小于 0, 那么返回 false, 表示减法运算不成功; 否则返回 true.\n * @author Radish\n */\nexport function subLaborForce(state: State, subtractor: string): boolean {\n  return sub(state, \"laborForce\", subtractor);\n}\n\n/**\n * 增加劳动力上限\n * @author Radish\n */\nexport function addMaxLaborForce(\n  state: State,\n  addend: string\n): { laborForce: string; maxLaborForce: string } {\n  let laborForce = add(state, \"laborForce\", addend);\n  let maxLaborForce = add(state, \"maxLaborForce\", addend);\n  return { laborForce, maxLaborForce };\n}\n\n/**\n * 判断是否能够减少劳动力上限\n * @author Radish\n */\nexport function isCanSubMaxLaborForce(\n  state: State,\n  subtractor: string\n): boolean {\n  let laborForce = getLaborForce(state);\n  let maxLaborForce = getMaxLaborForce(state);\n  let result = laborForce == maxLaborForce;\n  if (result) {\n    return isCanSub(state, \"maxLaborForce\", subtractor);\n  }\n  return result;\n}\n\n/**\n * 判断是否能够减少劳动力上限\n * @author Radish\n */\nexport function subMaxLaborForce(state: State, subtractor: string): boolean {\n  if (isCanSubMaxLaborForce(state, subtractor)) {\n    sub(state, \"laborForce\", subtractor);\n    sub(state, \"maxLaborForce\", subtractor);\n    return true;\n  }\n  return false;\n}\n","/**\n * 分配劳动力给素材的相关功能\n * @author Radish\n */\n\nimport State from \"../State\";\nimport { IProp } from \"../Types\";\nimport { getProp } from \"./HandlePropSystem\";\nimport {\n  getLaborForce,\n  getMaxLaborForce,\n  addLaborForce,\n  subLaborForce\n} from \"./DeployLaborForceSystem\";\nimport Big from \"big.js\";\n\n/**\n * 给素材分配劳动力\n * @returns true 操作成功, false 操作失败\n * @author Radish\n */\nexport function addLaborForceToProp(\n  state: State,\n  propId: string,\n  addedLaborForce: string\n): boolean {\n  let prop = getProp(state, propId);\n  let bigCurrentLaborForce = new Big(getLaborForce(state));\n  let bigAddedLaborForce = new Big(addedLaborForce);\n  if (bigCurrentLaborForce.gte(bigAddedLaborForce)) {\n    prop.laborForce = bigAddedLaborForce.add(prop.laborForce).toString();\n    state.set(\"props[\" + prop.id + \"]\", prop);\n    subLaborForce(state, addedLaborForce);\n    return true;\n  }\n  return false;\n}\n\n/**\n * 给素材减少劳动力\n * @author Radish\n */\nexport function subLaborForceFromProp(\n  state: State,\n  propId: string,\n  subedLaborForce: string\n): boolean {\n  let prop = getProp(state, propId);\n  let bigPropCurrentLaborForce = new Big(prop.laborForce);\n  if (bigPropCurrentLaborForce.gte(subedLaborForce)) {\n    prop.laborForce = bigPropCurrentLaborForce\n      .minus(subedLaborForce)\n      .toString();\n    state.set(\"props[\" + prop.id + \"]\", prop);\n    addLaborForce(state, subedLaborForce);\n    return true;\n  }\n  return false;\n}\n","/**\n * 格式化文本相关处理\n * @author Radish\n */\n\nimport Big from \"big.js\";\nimport {\n  B_CONFINE_MAX,\n  K_CONFINE_MAX,\n  M_CONFINE_MAX,\n  G_CONFINE_MAX\n} from \"../Consts\";\n\n/**\n * 格式化道具当前数量文本\n * @author Radish\n */\nexport function formatPropNum(num: string): string {\n  let bigNum = new Big(num);\n  if (bigNum.lt(B_CONFINE_MAX)) {\n    return num;\n  } else if (bigNum.lt(K_CONFINE_MAX)) {\n    return bigNum.div(B_CONFINE_MAX).toFixed(2) + \"K\";\n  } else if (bigNum.lt(M_CONFINE_MAX)) {\n    return bigNum.div(K_CONFINE_MAX).toFixed(2) + \"M\";\n  } else if (bigNum.lt(G_CONFINE_MAX)) {\n    return bigNum.div(M_CONFINE_MAX).toFixed(2) + \"G\";\n  } else {\n    return bigNum.div(G_CONFINE_MAX).toFixed(2) + \"T\";\n  }\n}\n","/**\n * 处理道具相关功能的系统\n * @author Radish\n */\n\nimport State from \"../State\";\nimport { IProp, IPropConfig } from \"../Types\";\nimport { PLACE_PROP_ID } from \"../Consts\";\nimport Big from \"big.js\";\n\n/**\n * 获得道具的路由键\n * @author Radish\n */\nexport function getPropKey(propId: string) {\n  return \"props\" + `[${propId}]`;\n}\n\n/**\n * 获得默认的道具数据对象\n * @return 返回实际的实例引用\n * @author Radish\n */\nexport function getDefaultProp(propId: string): IProp {\n  return {\n    id: propId,\n    num: \"0\",\n    lastNum: \"0\",\n    laborForce: \"0\",\n    increaseRate: \"0\"\n  };\n}\n\n/**\n * 设置 prop\n * @author Radish\n */\nexport function setProp(state: State, prop: IProp) {\n  let route = getPropKey(prop.id);\n  state.set(route, prop);\n}\n\n/**\n * 获得指定道具数量\n * @returns 实例副本, 浅拷贝\n * @author Radish\n */\nexport function getProp(state: State, propId: string): IProp {\n  let route = getPropKey(propId);\n  let prop = state.get(route, getDefaultProp(propId));\n  return Object.assign({}, prop);\n}\n\n/**\n * 计算增长率\n * @author Radish\n */\nexport function calculateIncreaseRate(\n  state: State,\n  propId: string,\n  duration: number\n) {\n  let prop: IProp = getProp(state, propId);\n  let bigNum = new Big(prop.num);\n  prop.increaseRate = bigNum\n    .sub(prop.lastNum)\n    .div(duration)\n    .toString();\n  setProp(state, prop);\n}\n\n/**\n * 计算纯的增长数量\n * @author Radish\n */\nfunction calculatePureProduceNum(state: State, propId: string, duration: number) {\n  let prop = getProp(state, propId);\n  let config = state.configs.props[propId];\n  return new Big(config.place.numPerSec)\n    .mul(config.place.numPerLaborForce)\n    .mul(prop.laborForce)\n    .mul(duration)\n    .toString();\n}\n\n/**\n * 道具生产\n * @author Radish\n */\nfunction produceProp(\n  state: State,\n  propId: string,\n  filter: { [k: string]: boolean },\n  duration: number\n) {\n  if (filter[propId]) {\n    return;\n  }\n  filter[propId] = true;\n\n  let config: IPropConfig = state.configs.props[propId];\n  if (config.place) {\n    let prop = getProp(state, propId);\n\n    if (config.place.dependencies) {\n      // 1. 预计算总消耗量\n      let advanceProduceNum = calculatePureProduceNum(state, propId, duration);\n      let actualProduceNum: Big = new Big(advanceProduceNum);\n\n      // 2. 生产依赖的素材\n      for (let { id, num } of config.place.dependencies) {\n        produceProp(state, id, filter, duration);\n\n        let depProp = getProp(state, id);\n\n        // 2.1 计算依赖道具需要的消耗\n        let bigConsume = new Big(num).mul(advanceProduceNum);\n\n        // 2.2 如果依赖道具不足, 那么根据当前依赖道具拥有的数量, 计算出实际合成产出, 这个产出是所有依赖道具所能产生的最小值\n        if (bigConsume.gt(depProp.num)) {\n          let tempActualProduceNum = new Big(depProp.num).div(num);\n          if (actualProduceNum.gt(tempActualProduceNum)) {\n            actualProduceNum = tempActualProduceNum;\n          }\n        }\n      }\n\n      // 没有生产则直接返回\n      if (actualProduceNum.eq(\"0\")) {\n        return;\n      }\n\n      // 3. 计算累加合成道具的数量\n      prop.num = actualProduceNum.add(prop.num).toString();\n      setProp(state, prop);\n\n      // 4. 根据实际的产出数量计算依赖道具的消耗\n      for (const { id, num } of config.place.dependencies) {\n        let depProp = getProp(state, id);\n        let consume: Big = new Big(num).mul(actualProduceNum);\n        depProp.num = new Big(depProp.num).sub(consume).toString();\n        setProp(state, depProp);\n      }\n    } else {\n      prop.num = new Big(calculatePureProduceNum(state, propId, duration)).add(prop.num).toString();\n      setProp(state, prop);\n    }\n  }\n}\n\n/**\n * 更新道具的数量\n * @author Radish\n */\nexport function produceProps(state: State, duration: number) {\n  for (let id of PLACE_PROP_ID) {\n    let prop = getProp(state, id);\n    prop.lastNum = prop.num;\n    setProp(state, prop);\n  }\n\n  let filter: { [k: string]: boolean } = {};\n  for (let id of PLACE_PROP_ID) {\n    produceProp(state, id, filter, duration);\n  }\n\n  for (let id of PLACE_PROP_ID) {\n    calculateIncreaseRate(state, id, duration);\n  }\n}\n","import { IOrigin } from \"../Types\";\n\n/**\n * 初始化 State.origin\n * @author Radish\n */\n\nexport function initOrigin(origin: IOrigin) {\n  if (!origin.timestamp) {\n    origin.timestamp = Date.now();\n  }\n\n  return origin;\n}\n\n","/**\n * 本地存储相关处理\n * @author Radish\n */\n\n/**\n * 获得本地存储的账户\n * @author Radish\n */\nexport function getAccount() {\n  return cc.sys.localStorage.getItem(\"account\");\n}\n\n/**\n * 设置本地存储的账户数据\n * @author Radish\n */\nexport function setAccount(account: string) {\n  cc.sys.localStorage.setItem(\"account\", account);\n}\n","/**\n * i18n 处理\n * @author Radish\n */\n\nimport NativeResponse from \"../../native/NativeResponse\";\n\nexport default class Localized {\n  /**\n   * 获得当前使用语言标识\n   * @author Radish\n   */\n  public static async getLanguage() {\n    if (!this.s_language) {\n      if (cc.sys.isBrowser) {\n        this.s_language = this.process(window.navigator.language);\n        return Promise.resolve(this.s_language);\n      }\n\n      if (cc.sys.os === cc.sys.OS_IOS) {\n        return new Promise(resolve => {\n          jsb.reflection.callStaticMethod(\n            \"QXQUtils\",\n            \"getLanguage:\",\n            JSON.stringify({\n              callback: NativeResponse.push((value: string) => {\n                this.s_language = this.process(value);\n                resolve(this.s_language);\n              })\n            })\n          );\n        });\n      } else {\n        this.s_language = \"en\";\n        return Promise.resolve(this.s_language);\n      }\n    } else {\n      return Promise.resolve(this.s_language);\n    }\n  }\n\n  /**\n   * 本地化文本内容, 异步\n   * @author Radish\n   */\n  public static async getValue(key: string) {\n    await this.loadLocalizedText();\n    return this.getValueSync(key);\n  }\n\n  /**\n   * 本地化文本内容, 同步\n   * @author Radish\n   */\n  public static getValueSync(key: string) {\n    let value = this.s_dict[key];\n    if (!value) {\n      value = this.s_defaultDict[key];\n      if (!value) {\n        return key;\n      }\n    }\n    return value;\n  }\n\n  /**\n   * 获得默认的 TTF 字体\n   * @author Radish\n   */\n  public static async getDefaultTTF() {\n    let language = await this.getLanguage();\n    return language + \"/fonts/default.ttf\";\n  }\n\n  /**\n   * 本地化 label 控件\n   * @author Radish\n   */\n  public static async localizeLabel(label: cc.Label) {\n    label.string = await this.getValue(label.string);\n    return new Promise(async (resolve, reject) => {\n      cc.loader.loadRes(await this.getDefaultTTF(), cc.Font, (err, font) => {\n        if (err) {\n          if (CC_DEBUG) {\n            reject(err);\n          } else {\n            resolve();\n          }\n        } else {\n          label.font = font;\n          resolve();\n        }\n      });\n    });\n  }\n\n  /**\n   * 获得本地化资源\n   * @author Radish\n   */\n  public static async getLocalizedRes(url: string) {\n    let language = await this.getLanguage();\n    return language + \"/\" + url;\n  }\n\n  /**\n   * 对浏览器/终端返回的语言字符串做处理\n   * @author Radish\n   */\n  private static process(value: string): string {\n    value = value.toLocaleLowerCase();\n    cc.log(`=> process value = ${value}`);\n\n    if (value.indexOf(\"zh-hant\") !== -1) {\n      return \"zh-hant\";\n    } else if (value.indexOf(\"zh-hans\") !== -1) {\n      return \"zh-hans\";\n    } else if (value.indexOf(\"zh-tw\") !== -1 || value.indexOf(\"zh-hk\") !== -1) {\n      return \"zh-hant\";\n    } else if (value.indexOf(\"zh-cn\") !== -1) {\n      return \"zh-hans\";\n    } else if (value === \"zh\") {\n      return \"zh-hans\";\n    } else {\n      return \"en\";\n    }\n  }\n\n  /**\n   * 加载本地化的文本\n   * @author Radish\n   */\n  private static async loadLocalizedText() {\n    if (this.s_dict === null && this.s_defaultDict === null) {\n      let language = await this.getLanguage();\n      let p1 = new Promise(async (resolve, reject) => {\n        cc.loader.loadRes(language + \"/configs/Localized\", (err, file) => {\n          if (!err) {\n            this.s_dict = file.json;\n            resolve();\n          } else {\n            reject();\n          }\n        });\n      });\n\n      let p2 = new Promise((resolve, reject) => {\n        cc.loader.loadRes(language + \"/configs/Localized\", (err, file) => {\n          if (!err) {\n            this.s_defaultDict = file.json;\n            resolve();\n          } else {\n            reject();\n          }\n        });\n      });\n      return p1.then(() => p2).catch(() => p2);\n    } else {\n      return Promise.resolve();\n    }\n  }\n\n  private static s_language: string = null;\n  private static s_dict: { [k: string]: string } = {};\n  private static s_defaultDict: { [k: string]: string } = {};\n}\n","const { ccclass } = cc._decorator;\n\nimport App from \"./App\";\nimport * as Utils from \"./sys/Utils\";\n\nconst LoginPrefabPath = \"prefabs/DemoLogin\";\n\n@ccclass\nexport default class MainComponent extends cc.Component {\n  async onLoad() {\n    App.getInstance().main = this.node;\n\n    let resource = await Utils.loadPrefab(LoginPrefabPath);\n    let loginNode = cc.instantiate(resource);\n    App.getInstance().gameContainer.addChild(loginNode as cc.Node);\n  }\n}\n","/**\n * Native 回调管理相关\n * @author Radish\n */\n\nlet s_session: number = 0;\nlet s_callbacks: { [s: number]: (value: string) => void } = {};\n\nexport default class NativeResponse {\n  /**\n   * 添加回调函数\n   * @author Radish\n   */\n  public static push(callback: (value: string) => void): number {\n    let session = ++s_session;\n    s_callbacks[session] = callback;\n    return session;\n  }\n}\n\nif (cc.sys.isNative) {\n  if (!jsb.onNativeResponse) {\n    jsb.onNativeResponse = (\n      session: number,\n      value?: string,\n      isRemove: boolean = true\n    ) => {\n      if (value === null || value === undefined) {\n        delete s_callbacks[session];\n      } else {\n        let callback = s_callbacks[session];\n        if (callback) {\n          callback(value);\n\n          if (isRemove) {\n            delete s_callbacks[session];\n          }\n        }\n      }\n    };\n  }\n}\n","/**\n * 数据相关处理内容\n * @author Radish\n */\n\nimport { EventEmitter } from \"events\";\nimport * as _ from \"lodash\";\nimport * as Utils from \"../sys/Utils\";\nimport Localized from \"../sys/i18n/Localized\";\nimport { IOrigin, IConfig } from \"./Types\";\nimport { initOrigin } from \"./system/InitOriginSystem\";\n\ninterface IStateExtend {\n  [k: string]: any;\n}\n\nexport default class State extends EventEmitter implements IStateExtend {\n  /**\n   * 获得 State 实例\n   * @author Radish\n   */\n  public static getInstance() {\n    if (this.s_instance === null) {\n      this.s_instance = new State();\n    }\n    return this.s_instance;\n  }\n\n  /**\n   * 设置 origin 值\n   * @author Radish\n   */\n  public set<T>(route: string, value: T) {\n    _.set(this.m_origin, route, value);\n    this.emit(\"attribute_changed\", { route, value });\n    this.emit(\"attribute_changed_\" + route, { route, value });\n  }\n\n  /**\n   * 获得 origin 值\n   * @author Radish\n   */\n  public get<T>(route: string, defaultValue?: T): T {\n    let value = _.get(this.m_origin, route);\n    if ((value === null || value === undefined) && defaultValue !== undefined) {\n      _.set(this.m_origin, route, defaultValue);\n      return defaultValue;\n    }\n    return value;\n  }\n\n  /**\n   * 获得 origin 实例\n   * @author Radish\n   */\n  public get origin() {\n    return this.m_origin;\n  }\n\n  /**\n   * 获得 configs 实例\n   * @author Radish\n   */\n  public get configs() {\n    return this.m_configs;\n  }\n\n  /**\n   * 数据存档\n   * @author Radish\n   */\n  public async save() {\n    cc.sys.localStorage.setItem(\n      this.getOriginLocalStorageKey(this.m_origin.user.account),\n      JSON.stringify(this.m_origin)\n    );\n  }\n\n  /**\n   * 加载配置\n   * @author Radish\n   */\n  public async loadConfigs() {\n    let propConfigs = await Utils.loadJson(\n      await Localized.getLocalizedRes(\"configs/Props\")\n    );\n    _.set(this.configs, \"props\", propConfigs);\n  }\n\n  /**\n   * 读取存档数据\n   * @author Radish\n   */\n  public async loadAccount(account: string) {\n    let jsonOrigin = cc.sys.localStorage.getItem(\n      this.getOriginLocalStorageKey(account)\n    );\n\n    if (jsonOrigin) {\n      this.m_origin = initOrigin(JSON.parse(jsonOrigin));\n    }\n  }\n\n  /****************************************************************************************************\n   * private\n   ****************************************************************************************************/\n\n  /**\n   * 获得本地存储玩家数据的键\n   * @author Radish\n   */\n  private getOriginLocalStorageKey(account: string) {\n    return account + \"-origin\";\n  }\n\n  private m_origin: IOrigin = {\n    user: {},\n    laborForce: \"0\",\n    props: {},\n    timestamp: Date.now()\n  };\n\n  private m_configs: IConfig = {\n    props: {}\n  };\n\n  private constructor() {\n    super();\n\n    if (State.s_instance) {\n      new Error(\"State is already init.\");\n    }\n  }\n  private static s_instance: State = null;\n}\n","/**\n * 常用的工具整合\n * @author Radish\n */\n\n/**\n * 加载 cc.Prefab 资源\n * @author Radish\n */\nexport async function loadPrefab(url: string) {\n  return new Promise((resolve, reject) => {\n    cc.loader.loadRes(url, cc.Prefab, (err, resource) => {\n      if (err) {\n        if (CC_DEBUG) {\n          cc.error(err);\n        } else {\n          reject();\n        }\n      } else {\n        resolve(resource);\n      }\n    });\n  });\n}\n\n/**\n * 加载 json 资源\n * @author Radish\n */\nexport async function loadJson(url: string) {\n  return new Promise((resolve, reject) => {\n    cc.loader.loadRes(url, (err, jsonAssets) => {\n      if (err) {\n        if (CC_DEBUG) {\n          cc.error(err);\n        } else {\n          reject();\n        }\n      } else {\n        resolve(jsonAssets.json);\n      }\n    });\n  });\n}\n"],"sourceRoot":"/source/","file":"project.js"}